    <!DOCTYPE html>
    <html lang="pt-BR">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>Calend√°rio de Treinos</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                -webkit-tap-highlight-color: transparent;
            }

            body {
                background-color: #f5f5f5;
                color: #333;
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                touch-action: pan-y;
            }

            .header {
                background-color: #4285f4;
                color: white;
                padding: 3px;
                text-align: center;
                position: sticky;
                top: 0;
                z-index: 10;
            }

            .calendar-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 10px;
                flex-grow: 1;
            }

            .period-display {
                width: 100%;
                background-color: white;
                border-radius: 10px;
                padding: 15px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                margin-bottom: 15px;
                text-align: center;
            }

            .period-dates {
                display: flex;
                justify-content: space-around;
                margin: 10px 0;
                font-weight: bold;
                color: #4285f4;
            }

            .period-info {
                margin-top: 10px;
                font-size: 0.9rem;
            }

            .days-counter {
                display: flex;
                justify-content: space-around;
                width: 100%;
                background-color: white;
                border-radius: 10px;
                padding: 15px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                margin-bottom: 15px;
            }

            .counter-box {
                text-align: center;
                padding: 0 10px;
            }

            .counter-value {
                font-size: 1.5rem;
                font-weight: bold;
                color: #4285f4;
            }

            .counter-label {
                font-size: 0.8rem;
                color: #666;
            }

            .form-container {
                width: 100%;
                margin-bottom: 15px;
            }

            .form-group {
                margin-bottom: 10px;
            }

            .form-group label {
                display: block;
                margin-bottom: 5px;
                font-weight: bold;
                color: #555;
            }

            .form-control {
                width: 100%;
                padding: 10px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 1rem;
            }

            .training-days {
                display: flex;
                flex-wrap: wrap;
                gap: 5px;
                margin-top: 5px;
            }

            .training-day {
                flex: 1;
                min-width: calc(33% - 5px);
            }

            .training-day input {
                display: none;
            }

            .training-day label {
                display: block;
                padding: 8px;
                text-align: center;
                background-color: #f0f0f0;
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.2s;
            }

            .training-day input:checked + label {
                background-color: #4285f4;
                color: white;
            }

            textarea.form-control {
                min-height: 80px;
                resize: vertical;
            }

            .action-buttons {
                display: flex;
                gap: 10px;
                width: 100%;
                margin-bottom: 15px;
            }

            .action-buttons button {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                cursor: pointer;
            }

            .btn-save {
                background-color: #34a853;
            }

            .btn-reset {
                background-color: #ea4335;
            }

            .carousel {
                width: 100%;
                overflow: hidden;
                position: relative;
                margin-bottom: 15px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }

            .carousel-inner {
                display: flex;
                transition: transform 0.3s ease;
            }

            .calendar-month {
                min-width: 100%;
                padding: 8px;
                background-color: white;
            }

            .month-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                margin-bottom: 8px;
                background-color: #4285f4;
                color: white;
                border-radius: 8px;
            }

            .month-title {
                font-size: 1.2rem;
                font-weight: bold;
            }

            .carousel-nav {
                display: flex;
                justify-content: space-between;
                width: 100%;
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                pointer-events: none;
            }

            .carousel-nav button {
                background-color: rgba(66, 133, 244, 0.8);
                color: white;
                border: none;
                width: 36px;
                height: 36px;
                border-radius: 50%;
                cursor: pointer;
                pointer-events: auto;
                display: flex;
                align-items: center;
                justify-content: center;
                margin: 0 5px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            }

            .weekdays {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                text-align: center;
                font-weight: bold;
                font-size: 0.8rem;
                margin-bottom: 5px;
            }

            .weekday {
                padding: 5px;
            }

            .days-grid {
                display: grid;
                grid-template-columns: repeat(7, 1fr);
                gap: 3px;
            }

            .day {
                padding: 8px 0;
                text-align: center;
                border-radius: 5px;
                cursor: pointer;
                transition: all 0.2s;
                position: relative;
                aspect-ratio: 1;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                font-size: 0.9rem;
            }

            .day:hover {
                background-color: #e0e0e0;
            }


            .day.in-range {
                background-color: #a8dab5;
            }

            .day.range-start {
                background-color: #34a853;
                color: white;
                font-weight: bold;
                border-top-right-radius: 0;
                border-bottom-right-radius: 0;
            }

            .day.range-end {
                background-color: #34a853;
                color: white;
                font-weight: bold;
                border-top-left-radius: 0;
                border-bottom-left-radius: 0;
            }

            .day.other-month {
                color: #aaa;
                opacity: 0.7;
            }

            .day.training-day {
                background-color: #f4b400;
                color: white;
                font-weight: bold;
            }

            .day-number {
                font-size: 1rem;
            }

            .saved-periods {
                width: 100%;
                margin-top: 15px;
            }

            .saved-periods h3 {
                margin-bottom: 10px;
                text-align: center;
                color: #4285f4;
            }
            .day.selecting-start {
                background-color: #d4e6ff;
                font-weight: bold;
            }

            .period-item {
                background-color: white;
                border-radius: 8px;
                padding: 12px;
                margin-bottom: 10px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                position: relative;
            }

            .period-item-dates {
                display: flex;
                justify-content: space-between;
                font-weight: bold;
                margin-bottom: 5px;
            }

            .period-item-days {
                color: #4285f4;
                font-size: 0.9rem;
                margin-bottom: 5px;
            }

            .period-item-info {
                font-size: 0.9rem;
                color: #666;
                margin: 5px 0;
            }

            .period-item-actions {
                display: flex;
                gap: 5px;
                margin-top: 10px;
            }

            .period-item-actions button {
                padding: 5px 10px;
                border: none;
                border-radius: 4px;
                font-size: 0.8rem;
                cursor: pointer;
            }

            .btn-edit {
                background-color: #4285f4;
                color: white;
            }

            .btn-delete {
                background-color: #ea4335;
                color: white;
            }

            .no-periods {
                text-align: center;
                color: #666;
                padding: 10px;
            }

            .date-inputs {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }


            .btn-export {
                background-color: #0000002f;
            }

            .action-buttons button {
                /* Mantenha os estilos existentes e adicione: */
                font-size: 0.9rem; /* Ajuste para caber o terceiro bot√£o */
            }

            @media (max-width: 400px) {
                .action-buttons {
                    flex-wrap: wrap;
                }
                .action-buttons button {
                    min-width: calc(50% - 5px);
                    margin-bottom: 5px;
                }
            }

            .date-input {
                flex: 1;
            }

            @media (max-width: 400px) {
                .day {
                    padding: 5px 0;
                    font-size: 0.8rem;
                }
                
                .day-number {
                    font-size: 0.9rem;
                }
                
                .counter-value {
                    font-size: 1.2rem;
                }
                
                .training-day {
                    min-width: calc(50% - 5px);
                }
                
                .date-inputs {
                    flex-direction: column;
                    gap: 5px;
                }
            }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>Calend√°rio de Treinos</h1>
        </div>

        <div class="calendar-container">
            <div class="period-display">
                <div>Per√≠odo Selecionado</div>
                <div class="period-dates">
                    <span id="start-date-display">--/--/----</span>
                    <span>at√©</span>
                    <span id="end-date-display">--/--/----</span>
                </div>
                <div class="period-info">
                    <span id="total-days-display">0 dias</span>
                </div>
            </div>

            <div class="days-counter">
                <div class="counter-box">
                    <div class="counter-value" id="training-days-count">0</div>
                    <div class="counter-label">Dias de treino</div>
                </div>
                <div class="counter-box">
                    <div class="counter-value" id="total-days-count">0</div>
                    <div class="counter-label">Total de dias</div>
                </div>
            </div>

            <div class="form-container">
                <div class="date-inputs">
                    <div class="form-group date-input">
                        <label for="start-date-input">Data Inicial</label>
                        <input type="date" id="start-date-input" class="form-control">
                    </div>
                    <div class="form-group date-input">
                        <label for="end-date-input">Data Final</label>
                        <input type="date" id="end-date-input" class="form-control">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="belt-grade">Faixa/Grau</label>
                    <input type="text" id="belt-grade" class="form-control" placeholder="Ex: Faixa Azul, Grau 2">
                </div>
                
                <div class="form-group">
                    <label>Dias de Treino</label>
                    <div class="training-days">
                        <div class="training-day">
                            <input type="checkbox" id="day-1" name="trainingDays" value="1">
                            <label for="day-1">Segunda</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-2" name="trainingDays" value="2">
                            <label for="day-2">Ter√ßa</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-3" name="trainingDays" value="3">
                            <label for="day-3">Quarta</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-4" name="trainingDays" value="4">
                            <label for="day-4">Quinta</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-5" name="trainingDays" value="5">
                            <label for="day-5">Sexta</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-6" name="trainingDays" value="6">
                            <label for="day-6">S√°bado</label>
                        </div>
                        <div class="training-day">
                            <input type="checkbox" id="day-0" name="trainingDays" value="0">
                            <label for="day-0">Domingo</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="period-notes">Observa√ß√µes</label>
                    <textarea id="period-notes" class="form-control" placeholder="Anota√ß√µes sobre o per√≠odo de treino..."></textarea>
                </div>
            </div>

            <div class="carousel">
                <div class="carousel-inner" id="carousel-inner">
                    <!-- Os meses ser√£o gerados dinamicamente via JavaScript -->
                </div>
                <div class="carousel-nav">
                    <button id="prev-month">‚Üê</button>
                    <button id="next-month">‚Üí</button>
                </div>
            </div>

            <div class="action-buttons">
                <button id="save-period" class="btn-save">Salvar Per√≠odo</button>
                <button id="reset-period" class="btn-reset">Limpar</button>
            </div>
<button id="export-data" class="btn-export">Exportar Dados</button>
            <div class="saved-periods">
                <h3>Per√≠odos Salvos</h3>
                <div id="saved-periods-list">
                    <!-- Per√≠odos salvos ser√£o exibidos aqui -->
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Configura√ß√µes iniciais
                const today = new Date();
                let currentMonth = today.getMonth();
                let currentYear = today.getFullYear();
                let startDate = null;
                let endDate = null;
                let isSelectingStartDate = true;
                let savedPeriods = JSON.parse(localStorage.getItem('savedPeriods')) || [];
                let editingIndex = -1;
                let lastSelectedDay = null;
                
                // Elementos do DOM
                const carouselInner = document.getElementById('carousel-inner');
                const prevMonthBtn = document.getElementById('prev-month');
                const nextMonthBtn = document.getElementById('next-month');
                const startDateDisplay = document.getElementById('start-date-display');
                const endDateDisplay = document.getElementById('end-date-display');
                const totalDaysDisplay = document.getElementById('total-days-display');
                const trainingDaysCountEl = document.getElementById('training-days-count');
                const totalDaysCountEl = document.getElementById('total-days-count');
                const beltGradeInput = document.getElementById('belt-grade');
                const trainingDaysCheckboxes = document.querySelectorAll('input[name="trainingDays"]');
                const periodNotes = document.getElementById('period-notes');
                const savePeriodBtn = document.getElementById('save-period');
                const resetPeriodBtn = document.getElementById('reset-period');
                const savedPeriodsList = document.getElementById('saved-periods-list');
                const startDateInput = document.getElementById('start-date-input');
                const endDateInput = document.getElementById('end-date-input');

                // Gerar os 12 meses do carrossel
            function generateMonths() {
                carouselInner.innerHTML = '';
                
                for (let i = -1; i <= 1; i++) {
                    let month = currentMonth + i;
                    let year = currentYear;
                    
                    if (month < 0) {
                        month = 11;
                        year--;
                    } else if (month > 11) {
                        month = 0;
                        year++;
                    }
                    
                    const monthElement = document.createElement('div');
                    monthElement.className = 'calendar-month';
                    monthElement.innerHTML = generateMonthHTML(month, year);
                    
                    carouselInner.appendChild(monthElement);
                }
                
                updateCarouselPosition();
                updatePeriodDisplay();
                highlightTrainingDays();
                
                // Adicionar classe de sele√ß√£o aos dias
                if (!isSelectingStartDate && startDate) {
                    const startStr = formatDateForStorage(startDate);
                    const dayElement = document.querySelector(`.day[data-date="${startStr}"]`);
                    if (dayElement) {
                        dayElement.classList.add('selecting-end');
                    }
                }
            }

                            // Gerar HTML de um m√™s espec√≠fico
            function generateMonthHTML(month, year) {
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", 
                                "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];
                
                let html = `
                    <div class="month-header">
                        <div class="month-title">${monthNames[month]} ${year}</div>
                    </div>
                    <div class="weekdays">
                        <div class="weekday">Dom</div>
                        <div class="weekday">Seg</div>
                        <div class="weekday">Ter</div>
                        <div class="weekday">Qua</div>
                        <div class="weekday">Qui</div>
                        <div class="weekday">Sex</div>
                        <div class="weekday">S√°b</div>
                    </div>
                    <div class="days-grid">
                `;
                
                // Dias vazios no in√≠cio do m√™s
                for (let i = 0; i < startingDay; i++) {
                    html += `<div class="day other-month"></div>`;
                }
                
                // Dias do m√™s atual
                for (let i = 1; i <= daysInMonth; i++) {
                    const date = new Date(year, month, i);
                    const dateStr = date.toISOString().split('T')[0];
                    const isToday = dateStr === new Date().toISOString().split('T')[0];
                    const isSelected = dateStr === lastSelectedDay;
                    
                    let classes = ['day'];
                    if (isToday) classes.push('today');
                    if (isSelected) classes.push('selected');
                    
                    html += `
                        <div class="${classes.join(' ')}" data-date="${dateStr}">
                            <div class="day-number">${i}</div>
                        </div>
                    `;
                }
                
                // Dias vazios no final do m√™s
                const totalCells = Math.ceil((daysInMonth + startingDay) / 7) * 7;
                const remainingCells = totalCells - (daysInMonth + startingDay);
                
                for (let i = 0; i < remainingCells; i++) {
                    html += `<div class="day other-month"></div>`;
                }
                
                html += `</div>`;
                return html;
            }

                // Gerar HTML de um dia espec√≠fico
            function generateDayHTML(dayNumber, date, isOtherMonth) {
                const dateStr = formatDateForStorage(date);
                const todayStr = formatDateForStorage(new Date());
                const isToday = dateStr === todayStr;
                const isStartDate = startDate && dateStr === formatDateForStorage(startDate);
                const isEndDate = endDate && dateStr === formatDateForStorage(endDate);
                const isInRange = isDateInRange(date);
                const isTrainingDay = isTrainingDate(date);
                
                let classes = ['day'];
                if (isOtherMonth) classes.push('other-month');
                if (isToday) classes.push('today');
                if (isStartDate) classes.push('range-start');
                if (isEndDate) classes.push('range-end');
                if (isInRange && !isStartDate && !isEndDate) classes.push('in-range');
                if (isTrainingDay) classes.push('training-day');
                
                return `
                    <div class="${classes.join(' ')}" data-date="${dateStr}">
                        <div class="day-number">${dayNumber}</div>
                    </div>
                `;
            }
        // Fun√ß√£o para formatar a data para armazenamento (YYYY-MM-DD)
        function formatDateForStorage(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Fun√ß√£o para criar data a partir de string YYYY-MM-DD
        function createDateFromString(dateStr) {
            const parts = dateStr.split('-');
            return new Date(parts[0], parts[1] - 1, parts[2]);
        }
                // Destacar o dia selecionado
                function highlightSelectedDay(dateStr) {
                    // Remover a classe 'selected' de todos os dias
                    document.querySelectorAll('.day').forEach(day => {
                        day.classList.remove('selected');
                    });
                    
                    // Adicionar a classe 'selected' ao dia clicado
                    const dayElement = document.querySelector(`.day[data-date="${dateStr}"]`);
                    if (dayElement) {
                        dayElement.classList.add('selected');
                    }
                }

                // Verificar se a data est√° no intervalo selecionado
                function isDateInRange(date) {
                    if (!startDate || !endDate) return false;
                    
                    const dateStr = formatDateForStorage(date);
                    const startStr = formatDateForStorage(startDate);
                    const endStr = formatDateForStorage(endDate);
                    
                    return dateStr > startStr && dateStr < endStr;
                }

                // Verificar se a data √© um dia de treino
                function isTrainingDate(date) {
                    if (!startDate || !endDate) return false;
                    
                    const dateStr = date.toISOString().split('T')[0];
                    const startStr = startDate.toISOString().split('T')[0];
                    const endStr = endDate.toISOString().split('T')[0];
                    
                    // Verificar se est√° dentro do per√≠odo salvo
                    if (dateStr < startStr || dateStr > endStr) return false;
                    
                    // Verificar se √© um dia de treino selecionado
                    for (const period of savedPeriods) {
                        if (dateStr >= period.startDate.split('T')[0] && dateStr <= period.endDate.split('T')[0]) {
                            const dayOfWeek = date.getDay().toString();
                            if (period.trainingDays && period.trainingDays.includes(dayOfWeek)) {
                                return true;
                            }
                        }
                    }
                    
                    return false;
                }

                // Destacar dias de treino no calend√°rio
                function highlightTrainingDays() {
                    // Esta fun√ß√£o √© chamada automaticamente quando os meses s√£o gerados
                }

                function updateCarouselPosition() {
                    // Centraliza o m√™s atual (posi√ß√£o 1 no array de 3 meses)
                    carouselInner.style.transform = `translateX(-${100}%)`;
                }

                // Atualizar exibi√ß√£o do per√≠odo selecionado
                function updatePeriodDisplay() {
                    if (startDate) {
                        startDateDisplay.textContent = formatDate(startDate);
                        startDateInput.value = startDate.toISOString().split('T')[0];
                    } else {
                        startDateDisplay.textContent = '--/--/----';
                        startDateInput.value = '';
                    }
                    
                    if (endDate) {
                        endDateDisplay.textContent = formatDate(endDate);
                        endDateInput.value = endDate.toISOString().split('T')[0];
                    } else {
                        endDateDisplay.textContent = '--/--/----';
                        endDateInput.value = '';
                    }
                    
                    if (startDate && endDate) {
                        const totalDays = calculateTotalDays(startDate, endDate);
                        totalDaysDisplay.textContent = `${totalDays} ${totalDays === 1 ? 'dia' : 'dias'}`;
                        
                        const trainingDays = countTrainingDays(startDate, endDate);
                        trainingDaysCountEl.textContent = trainingDays;
                        totalDaysCountEl.textContent = totalDays;
                    } else {
                        totalDaysDisplay.textContent = '0 dias';
                        trainingDaysCountEl.textContent = '0';
                        totalDaysCountEl.textContent = '0';
                    }
                }

                // Formatar data para exibi√ß√£o
                function formatDate(date) {
                    if (!date) return '--/--/----';
                    const day = date.getDate().toString().padStart(2, '0');
                    const month = (date.getMonth() + 1).toString().padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                }

                // Calcular total de dias entre duas datas
                function calculateTotalDays(start, end) {
                    const diffTime = Math.abs(end - start);
                    return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                }

                // Contar dias de treino selecionados no per√≠odo
                function countTrainingDays(start, end) {
                    if (!start || !end) return 0;
                    
                    // Obter dias de treino selecionados
                    const selectedDays = [];
                    trainingDaysCheckboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            selectedDays.push(parseInt(checkbox.value));
                        }
                    });
                    
                    if (selectedDays.length === 0) return 0;
                    
                    let count = 0;
                    const current = new Date(start);
                    
                    while (current <= end) {
                        const dayOfWeek = current.getDay();
                        if (selectedDays.includes(dayOfWeek)) {
                            count++;
                        }
                        current.setDate(current.getDate() + 1);
                    }
                    
                    return count;
                }

                // Carregar per√≠odos salvos
                function loadSavedPeriods() {
                    savedPeriodsList.innerHTML = '';
                    
                    if (savedPeriods.length === 0) {
                        savedPeriodsList.innerHTML = '<div class="no-periods">Nenhum per√≠odo salvo</div>';
                        return;
                    }
                    
                    savedPeriods.forEach((period, index) => {
                        const periodItem = document.createElement('div');
                        periodItem.className = 'period-item';
                        
                        const startDate = new Date(period.startDate);
                        const endDate = new Date(period.endDate);
                        const totalDays = calculateTotalDays(startDate, endDate);
                        const trainingDays = countTrainingDays(startDate, endDate);
                        
                        // Formatando dias de treino
                        const trainingDaysNames = {
                            '0': 'Dom', '1': 'Seg', '2': 'Ter', '3': 'Qua', 
                            '4': 'Qui', '5': 'Sex', '6': 'S√°b'
                        };
                        const trainingDaysDisplay = period.trainingDays 
                            ? period.trainingDays.map(day => trainingDaysNames[day]).join(', ')
                            : 'Nenhum dia selecionado';
                        
                        periodItem.innerHTML = `
                            <div class="period-item-dates">
                                <span>${formatDate(startDate)}</span>
                                <span>at√©</span>
                                <span>${formatDate(endDate)}</span>
                            </div>
                            <div class="period-item-days">${totalDays} dias (${trainingDays} dias de treino)</div>
                            ${period.beltGrade ? `<div class="period-item-info"><strong>Faixa/Grau:</strong> ${period.beltGrade}</div>` : ''}
                            <div class="period-item-info"><strong>Dias de Treino:</strong> ${trainingDaysDisplay}</div>
                            ${period.notes ? `<div class="period-item-info"><strong>Observa√ß√µes:</strong> ${period.notes}</div>` : ''}
                            <div class="period-item-actions">
                                <button class="btn-edit" data-index="${index}">Editar</button>
                                <button class="btn-delete" data-index="${index}">Excluir</button>
                            </div>
                        `;
                        
                        savedPeriodsList.appendChild(periodItem);
                    });
                    
                    // Adicionar event listeners aos bot√µes
                    document.querySelectorAll('.btn-edit').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.dataset.index);
                            editSavedPeriod(index);
                        });
                    });
                    
                    document.querySelectorAll('.btn-delete').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.dataset.index);
                            deleteSavedPeriod(index);
                        });
                    });
                }

                // Editar per√≠odo salvo
                function editSavedPeriod(index) {
                    const period = savedPeriods[index];
                    startDate = new Date(period.startDate);
                    endDate = new Date(period.endDate);
                    beltGradeInput.value = period.beltGrade || '';
                    periodNotes.value = period.notes || '';
                    
                    // Marcar os checkboxes dos dias de treino
                    trainingDaysCheckboxes.forEach(checkbox => {
                        checkbox.checked = period.trainingDays && period.trainingDays.includes(checkbox.value);
                    });
                    
                    // Navegar para o m√™s da data inicial
                    currentMonth = startDate.getMonth();
                    currentYear = startDate.getFullYear();
                    
                    editingIndex = index;
                    savePeriodBtn.textContent = 'Atualizar';
                    
                    generateMonths();
                    updatePeriodDisplay();
                    
                    // Rolagem suave para o topo
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }

                // Excluir per√≠odo salvo
                function deleteSavedPeriod(index) {
                    if (confirm('Tem certeza que deseja excluir este per√≠odo?')) {
                        savedPeriods.splice(index, 1);
                        localStorage.setItem('savedPeriods', JSON.stringify(savedPeriods));
                        loadSavedPeriods();
                        
                        // Se estava editando o item exclu√≠do, limpar o formul√°rio
                        if (editingIndex === index) {
                            resetForm();
                        }
                    }
                }

                // Selecionar data ao clicar
            carouselInner.addEventListener('click', function(e) {
                const dayElement = e.target.closest('.day');
                if (dayElement && !dayElement.classList.contains('other-month')) {
                    const dateStr = dayElement.dataset.date;
                    const date = createDateFromString(dateStr);
                    
                    // Se n√£o h√° data inicial ou estamos reiniciando a sele√ß√£o
                    if (!startDate || (startDate && endDate)) {
                        startDate = date;
                        endDate = null;
                        isSelectingStartDate = false;
                        lastSelectedDay = dateStr;
                    } 
                    // Se j√° temos data inicial mas n√£o final
                    else if (startDate && !endDate) {
                        if (date < startDate) {
                            endDate = startDate;
                            startDate = date;
                        } else {
                            endDate = date;
                        }
                        isSelectingStartDate = true;
                        lastSelectedDay = dateStr;
                    }
                    
                    generateMonths();
                    updatePeriodDisplay();
                }
            });

            startDateInput.addEventListener('change', function() {
                if (this.value) {
                    startDate = new Date(this.value);
                    isSelectingStartDate = false;
                    
                    // Se houver data final e for anterior √† nova data inicial, limpar
                    if (endDate && endDate < startDate) {
                        endDate = null;
                    }
                    
                    generateMonths();
                    updatePeriodDisplay();
                }
            });

            endDateInput.addEventListener('change', function() {
                if (this.value) {
                    endDate = new Date(this.value);
                    isSelectingStartDate = true;
                    
                    // Verificar se a data final √© anterior √† data inicial
                    if (startDate && endDate < startDate) {
                        const temp = startDate;
                        startDate = endDate;
                        endDate = temp;
                    }
                    
                    generateMonths();
                    updatePeriodDisplay();
                }
            });

                                endDateInput.addEventListener('change', function() {
                    if (this.value) {
                        endDate = new Date(this.value);
                        isSelectingStartDate = true;
                        
                        // Verificar se a data final √© anterior √† data inicial
                        if (endDate < startDate) {
                            const temp = startDate;
                            startDate = endDate;
                            endDate = temp;
                        }
                        
                        generateMonths();
                        updatePeriodDisplay();
                    }
                });

                // Salvar per√≠odo
                savePeriodBtn.addEventListener('click', function() {
                    if (!startDate || !endDate) {
                        alert('Selecione um per√≠odo completo (data inicial e final)');
                        return;
                    }
                    
                    // Obter dias de treino selecionados
                    const trainingDays = [];
                    trainingDaysCheckboxes.forEach(checkbox => {
                        if (checkbox.checked) {
                            trainingDays.push(checkbox.value);
                        }
                    });
                    
                    const period = {
                        startDate: startDate.toISOString(),
                        endDate: endDate.toISOString(),
                        beltGrade: beltGradeInput.value.trim(),
                        trainingDays: trainingDays,
                        notes: periodNotes.value.trim()
                    };
                    
                    if (editingIndex >= 0) {
                        // Atualizar per√≠odo existente
                        savedPeriods[editingIndex] = period;
                        editingIndex = -1;
                        savePeriodBtn.textContent = 'Salvar Per√≠odo';
                    } else {
                        // Adicionar novo per√≠odo
                        savedPeriods.unshift(period);
                    }
                    
                    localStorage.setItem('savedPeriods', JSON.stringify(savedPeriods));
                    
                    loadSavedPeriods();
                    generateMonths(); // Para atualizar os highlights de treino
                    
                    // Feedback visual
                    const buttonText = savePeriodBtn.textContent;
                    savePeriodBtn.textContent = 'Salvo!';
                    setTimeout(() => {
                        savePeriodBtn.textContent = buttonText;
                    }, 2000);
                    
                    // Limpar formul√°rio se n√£o estiver editando
                    if (editingIndex === -1) {
                        resetForm();
                    }
                });

                // Resetar formul√°rio
                function resetForm() {
                    startDate = null;
                    endDate = null;
                    isSelectingStartDate = true;
                    beltGradeInput.value = '';
                    periodNotes.value = '';
                    trainingDaysCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    lastSelectedDay = null;
                    
                    generateMonths();
                    updatePeriodDisplay();
                    
                    // Feedback visual
                    resetPeriodBtn.textContent = 'Limpo!';
                    setTimeout(() => {
                        resetPeriodBtn.textContent = 'Limpar';
                    }, 2000);
                }

                // Resetar sele√ß√£o
                resetPeriodBtn.addEventListener('click', resetForm);

               
                // Navega√ß√£o entre meses
                prevMonthBtn.addEventListener('click', function() {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    generateMonths();
                });

                nextMonthBtn.addEventListener('click', function() {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    generateMonths();
                });

                // Suporte para arrastar (swipe) no mobile
                let touchStartX = 0;
                let touchEndX = 0;
                
                carouselInner.addEventListener('touchstart', function(e) {
                    touchStartX = e.changedTouches[0].screenX;
                }, {passive: true});
                
                carouselInner.addEventListener('touchend', function(e) {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, {passive: true});
                
                function handleSwipe() {
                    const threshold = 50; // m√≠nima dist√¢ncia para considerar swipe
                    
                    if (touchEndX < touchStartX - threshold) {
                        // Swipe para a esquerda (pr√≥ximo m√™s)
                        if (currentMonth < 11) {
                            currentMonth++;
                        } else {
                            currentMonth = 0;
                            currentYear++;
                        }
                        generateMonths();
                    } else if (touchEndX > touchStartX + threshold) {
                        // Swipe para a direita (m√™s anterior)
                        if (currentMonth > 0) {
                            currentMonth--;
                        } else {
                            currentMonth = 11;
                            currentYear--;
                        }
                        generateMonths();
                    }
                }

                // Inicializar

                // Elemento do bot√£o de exporta√ß√£o
const exportBtn = document.getElementById('export-data');

// Fun√ß√£o para exportar como CSV
function exportToCSV() {
    if (savedPeriods.length === 0) {
        alert('Nenhum dado para exportar');
        return;
    }

    // Cabe√ßalhos do CSV
    let csv = 'Data Inicial,Data Final,Dias Totais,Dias de Treino,Faixa/Grau,Dias de Treino,Observa√ß√µes\n';

    // Adicionar cada per√≠odo
    savedPeriods.forEach(period => {
        const startDate = new Date(period.startDate);
        const endDate = new Date(period.endDate);
        const totalDays = calculateTotalDays(startDate, endDate);
        const trainingDays = countTrainingDays(startDate, endDate);
        
        // Formatando dias de treino
        const trainingDaysNames = {
            '0': 'Dom', '1': 'Seg', '2': 'Ter', '3': 'Qua', 
            '4': 'Qui', '5': 'Sex', '6': 'S√°b'
        };
        const trainingDaysDisplay = period.trainingDays 
            ? period.trainingDays.map(day => trainingDaysNames[day]).join('; ')
            : 'Nenhum';
        
        // Adicionar linha ao CSV
        csv += `"${formatDate(startDate)}","${formatDate(endDate)}",${totalDays},${trainingDays},"${period.beltGrade || ''}","${trainingDaysDisplay}","${period.notes || ''}"\n`;
    });

            // Criar link de download
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `treinos_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Fun√ß√£o para exportar como JSON
        function exportToJSON() {
            if (savedPeriods.length === 0) {
                alert('Nenhum dado para exportar');
                return;
            }

            // Criar c√≥pia dos dados para exporta√ß√£o
            const exportData = savedPeriods.map(period => {
                return {
                    startDate: formatDate(new Date(period.startDate)),
                    endDate: formatDate(new Date(period.endDate)),
                    totalDays: calculateTotalDays(new Date(period.startDate), new Date(period.endDate)),
                    trainingDays: countTrainingDays(new Date(period.startDate), new Date(period.endDate)),
                    beltGrade: period.beltGrade || '',
                    trainingDaysList: period.trainingDays || [],
                    notes: period.notes || ''
                };
            });

            // Criar link de download
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `treinos_${new Date().toISOString().slice(0,10)}.json`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Menu de exporta√ß√£o
        exportBtn.addEventListener('click', function() {
            if (savedPeriods.length === 0) {
                alert('Nenhum dado para exportar');
                return;
            }

            const exportType = prompt('Exportar como:\n1 - CSV\n2 - JSON\n\nDigite 1 ou 2');
            
            if (exportType === '1') {
                exportToCSV();
            } else if (exportType === '2') {
                exportToJSON();
            } else {
                alert('Op√ß√£o inv√°lida');
            }
        });
                generateMonths();
                loadSavedPeriods();
            });
        </script>
    </body>
    </html>
